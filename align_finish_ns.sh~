#!/bin/bash

echo -e "\e[105mAVISO: para evitar problemas, lanzar en carpeta vacía\e[49m"

read -p "Archivo del alineamiento: " alin_file

read -p "Secuencia de referencia: " ref_file #con esta seq hará el conteo de nts
nt_output="$(grep -v ">" $ref_file | wc | awk '{print $3-$1}')" #conteo nt

echo "Nombre del output (acabado en .aln):" 
read output_filename

echo -e "\e[105mProcesando el alineamiento $alin_file con referencia de $nt_output nt\e[49m"

awk '/^>/ {OUT=substr($0,2) ".fa"}; {print >> OUT; close(OUT)}' $alin_file #split de las secuencias del alineamiento

c="n"

for i in ./*.fa; do
	nt_file="$(grep -v ">" $i | wc | awk '{print $3-$1}')"; #conteo nt muestra
	if [[ "$nt_file" < "$nt_output" ]]; then
		echo -e "Incorporando ns a $i"
		ns=$(($nt_output-$nt_file)) #ns totales necesarias
		APPENDns=$(printf ''$c'%.0s' $(seq 1 $ns)) #repite "n" (almacenado en c) tantas veces como la variable "ns" sea... y las incorpora al final del archivo
		echo "$(cat $i)$APPENDns" > $i
	fi
done

echo -e "\e[105mEscribiendo alineamiento en $output_filename\e[49m"
cat *.fa > "$output_filename"

rm *.fa

